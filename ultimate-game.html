<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate 3D Racing Game - Complete Edition</title>
    <meta name="description" content="È´òÊÄßËÉΩ3D„É¨„Éº„Ç∑„É≥„Ç∞„Ç≤„Éº„É† - ÂÆåÂÖ®Áâà„ÄÇ„É°„Éã„É•„Éº„Ç∑„Çπ„ÉÜ„É†„ÄÅÈü≥ÈüøÂäπÊûú„ÄÅ„Éá„Éº„Çø‰øùÂ≠òÊ©üËÉΩ„ÇíÂê´„ÇÄÁ∑èÂêà„É¨„Éº„Ç∑„É≥„Ç∞‰ΩìÈ®ì">
    <meta name="keywords" content="3D„É¨„Éº„Ç∑„É≥„Ç∞,„Éñ„É©„Ç¶„Ç∂„Ç≤„Éº„É†,WebGL,Three.js">
    
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Arial', sans-serif;
            user-select: none;
        }
        
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        
        #ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }
        
        /* HUDË¶ÅÁ¥† */
        #hud {
            position: absolute;
            bottom: 20px;
            right: 20px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            background: linear-gradient(135deg, rgba(0,0,0,0.8), rgba(0,0,0,0.6));
            padding: 20px;
            border-radius: 15px;
            min-width: 280px;
            border: 2px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            pointer-events: none;
        }
        
        .hud-section {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        
        .hud-section:last-child {
            margin-bottom: 0;
            border-bottom: none;
            padding-bottom: 0;
        }
        
        .speedometer {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .speed-gauge {
            width: 80px;
            height: 80px;
            border: 3px solid #333;
            border-radius: 50%;
            position: relative;
            background: radial-gradient(circle, #1a1a1a, #000);
        }
        
        .speed-needle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 2px;
            height: 35px;
            background: #ff4444;
            transform-origin: bottom center;
            transform: translate(-50%, -100%) rotate(0deg);
            transition: transform 0.1s ease;
        }
        
        .speed-center {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 8px;
            height: 8px;
            background: #ff4444;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        
        .lap-indicator {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }
        
        .lap-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #333;
            transition: background 0.3s;
        }
        
        .lap-dot.completed {
            background: #4CAF50;
        }
        
        .lap-dot.current {
            background: #FFD700;
        }
        
        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 14px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            background: linear-gradient(135deg, rgba(0,0,0,0.8), rgba(0,0,0,0.6));
            padding: 15px;
            border-radius: 10px;
            border: 2px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            pointer-events: none;
        }
        
        #performance {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 12px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            background: linear-gradient(135deg, rgba(0,0,0,0.8), rgba(0,0,0,0.6));
            padding: 12px;
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            pointer-events: none;
        }
        
        #minimap {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 200px;
            height: 200px;
            background: linear-gradient(135deg, rgba(0,0,0,0.8), rgba(0,0,0,0.6));
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            backdrop-filter: blur(10px);
            pointer-events: none;
            overflow: hidden;
        }
        
        .minimap-track {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 160px;
            height: 100px;
            border: 2px solid #666;
            border-radius: 50px;
            transform: translate(-50%, -50%);
        }
        
        .minimap-car {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #ff4444;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.1s ease;
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            text-align: center;
            z-index: 1000;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
        @media (max-width: 768px) {
            #hud {
                font-size: 14px;
                padding: 15px;
                min-width: 220px;
                bottom: 10px;
                right: 10px;
            }
            
            #controls {
                font-size: 12px;
                padding: 10px;
                top: 10px;
                left: 10px;
            }
            
            #performance {
                font-size: 10px;
                padding: 8px;
                top: 10px;
                right: 10px;
            }
            
            #minimap {
                width: 150px;
                height: 150px;
                bottom: 10px;
                left: 10px;
            }
        }
        
        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂäπÊûú */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£ */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        
        <div id="ui">
            <!-- Êìç‰Ωú„Ç¨„Ç§„Éâ -->
            <div id="controls" class="fade-in">
                <h3 style="margin: 0 0 10px 0; color: #4CAF50;">üéÆ Êìç‰ΩúÊñπÊ≥ï</h3>
                <div style="display: grid; grid-template-columns: auto 1fr; gap: 8px; font-size: 12px;">
                    <div>W/‚Üë</div><div>Âä†ÈÄü</div>
                    <div>S/‚Üì</div><div>Ê∏õÈÄü„Éª„Éê„ÉÉ„ÇØ</div>
                    <div>A/‚Üê</div><div>Â∑¶„Çπ„ÉÜ„Ç¢„É™„É≥„Ç∞</div>
                    <div>D/‚Üí</div><div>Âè≥„Çπ„ÉÜ„Ç¢„É™„É≥„Ç∞</div>
                    <div>Space</div><div>„Éè„É≥„Éâ„Éñ„É¨„Éº„Ç≠</div>
                    <div>R</div><div>„É™„Çª„ÉÉ„Éà</div>
                    <div>C</div><div>„Ç´„É°„É©ÂàáÊõø</div>
                    <div>Q/E</div><div>„ÇÆ„Ç¢‚Üì/‚Üë</div>
                    <div>T</div><div>AT/MTÂàáÊõø</div>
                    <div>Left Shift</div><div>„ÇØ„É©„ÉÉ„ÉÅ</div>
                    <div>ESC</div><div>„É°„Éã„É•„Éº</div>
                </div>
            </div>
            
            <!-- „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊÉÖÂ†± -->
            <div id="performance" class="fade-in">
                <div style="color: #4CAF50; font-weight: bold; margin-bottom: 5px;">üìä „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ</div>
                <div>FPS: <span id="fpsDisplay">60</span></div>
                <div>‰∏âËßíÂΩ¢: <span id="trianglesDisplay">0</span></div>
                <div>ÊèèÁîª„Ç≥„Éº„É´: <span id="drawCallsDisplay">0</span></div>
                <div>„Ç´„É°„É©: <span id="cameraModeDisplay">Follow</span></div>
            </div>
            
            <!-- „É°„Ç§„É≥HUD -->
            <div id="hud" class="fade-in">
                <div class="hud-section">
                    <div class="speedometer">
                        <div class="speed-gauge">
                            <div class="speed-needle" id="speedNeedle"></div>
                            <div class="speed-center"></div>
                        </div>
                        <div>
                            <div style="font-size: 24px; color: #FFD700;">
                                <span id="speed">0</span> <span style="font-size: 14px;">km/h</span>
                            </div>
                            <div style="font-size: 14px; color: #888;">
                                „ÇÆ„Ç¢: <span id="gearDisplay">1</span> <span id="transmissionMode" style="color: #4CAF50;">[AT]</span> | RPM: <span id="rpm">800</span>
                            </div>
                            <div style="font-size: 12px; color: #666; margin-top: 2px;">
                                <span id="clutchDisplay">„ÇØ„É©„ÉÉ„ÉÅ: 100%</span> | <span id="shiftingIndicator"></span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="hud-section">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="color: #4CAF50;">„É©„ÉÉ„Éó: <span id="currentLap">1</span> / <span id="totalLaps">3</span></div>
                            <div class="lap-indicator" id="lapIndicator">
                                <div class="lap-dot current"></div>
                                <div class="lap-dot"></div>
                                <div class="lap-dot"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="hud-section">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px;">
                        <div>ÁèæÂú®: <span id="currentTime" style="color: #FFD700;">0:00.00</span></div>
                        <div>„Éô„Çπ„Éà: <span id="bestTime" style="color: #4CAF50;">--:--</span></div>
                        <div>„É©„ÉÉ„Éó: <span id="lapTime" style="color: #2196F3;">0:00.00</span></div>
                        <div>ÂâçÂõû: <span id="lastLap" style="color: #888;">--:--</span></div>
                    </div>
                </div>
                
                <div class="hud-section" style="border-bottom: none;">
                    <div style="margin-bottom: 5px;">
                        <div style="display: flex; justify-content: space-between; font-size: 12px;">
                            <span>„Çπ„Éî„Éº„Éâ</span>
                            <span id="speedPercentage">0%</span>
                        </div>
                        <div style="background: #333; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div id="speedBar" style="background: linear-gradient(90deg, #4CAF50, #FFD700, #ff4444); height: 100%; width: 0%; transition: width 0.2s;"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- „Éü„Éã„Éû„ÉÉ„Éó -->
            <div id="minimap" class="fade-in">
                <div style="color: white; font-size: 12px; padding: 8px; text-align: center; background: rgba(0,0,0,0.5);">
                    üìç „Ç≥„Éº„Çπ‰ΩçÁΩÆ
                </div>
                <div class="minimap-track">
                    <div class="minimap-car" id="minimapCar"></div>
                </div>
            </div>
        </div>
        
        <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞ÁîªÈù¢ -->
        <div id="loading">
            <div class="loading-spinner"></div>
            <div>„Ç≤„Éº„É†„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>
            <div style="font-size: 14px; color: #888; margin-top: 10px;">
                Ultimate 3D Racing Game - Complete Edition
            </div>
        </div>
    </div>

    <!-- „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£Áî®Èö†„Åó„ÉÜ„Ç≠„Çπ„Éà -->
    <div class="sr-only" aria-live="polite" id="screenReader"></div>

    <!-- Three.js -->
    <script src="three.js"></script>
    
    <!-- WebGLË®∫Êñ≠„Ç∑„Çπ„ÉÜ„É† -->
    <script src="webglDiagnostic.js"></script>
    
    <!-- Êñ∞Ë¶èËøΩÂä†„Ç∑„Çπ„ÉÜ„É† -->
    <script src="errorHandler.js"></script>
    <script src="audioSystem.js"></script>
    <script src="dataManager.js"></script>
    <script src="gameStateManager.js"></script>
    
    <!-- „Ç≤„Éº„É†„Ç≥„Ç¢„Ç∑„Çπ„ÉÜ„É† -->
    <script src="utils.js"></script>
    <script src="physics.js"></script>
    <script src="car.js"></script>
    <script src="track.js"></script>
    <script src="camera.js"></script>
    <script src="game.js"></script>
    
    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let game = null;
        let gameStateManager = null;
        let isGameInitialized = false;
        
        // ÂàùÊúüÂåñ„É°„Ç§„É≥Èñ¢Êï∞
        async function initializeGame() {
            try {
                // ‰∫íÊèõÊÄß„ÉÅ„Çß„ÉÉ„ÇØ
                const compatibilityIssues = window.compatibilityChecker.checkCompatibility();
                
                if (compatibilityIssues.some(issue => issue.severity === 'critical')) {
                    throw new Error('„Éñ„É©„Ç¶„Ç∂„ÅåÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                }
                
                // „Ç≤„Éº„É†Áä∂ÊÖã„Éû„Éç„Éº„Ç∏„É£„Éº„ÅÆÂàùÊúüÂåñ
                gameStateManager = new GameStateManager();
                
                // „É°„Ç§„É≥„Ç≤„Éº„É†„ÅÆÂàùÊúüÂåñ
                game = new Game();
                gameStateManager.game = game;
                
                // „Ç≤„Éº„É†ÂàùÊúüÂåñÂÆå‰∫Ü„ÇíÂæÖÊ©ü
                await game.initPromise;
                
                // „Ç™„Éº„Éá„Ç£„Ç™„Ç∑„Çπ„ÉÜ„É†„ÅÆÂàùÊúüÂåñ
                await window.audioManager.resumeContext();
                
                // „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÁõ£Ë¶ñÈñãÂßã
                window.errorHandler.startPerformanceMonitoring();
                
                // UIÊõ¥Êñ∞„ÅÆÈñãÂßã
                startUIUpdates();
                
                // „É≠„Éº„Éá„Ç£„É≥„Ç∞ÁîªÈù¢„ÇíÈùûË°®Á§∫
                document.getElementById('loading').style.display = 'none';
                
                // „É°„Éã„É•„ÉºÁä∂ÊÖã„Å´Ë®≠ÂÆö
                gameStateManager.setState('menu');
                
                isGameInitialized = true;
                console.log('Game initialized successfully');
                
            } catch (error) {
                console.error('Failed to initialize game:', error);
                window.errorHandler.handleError({
                    type: 'Initialization Error',
                    message: error.message,
                    severity: 'critical'
                });
            }
        }
        
        // UIÊõ¥Êñ∞„É´„Éº„Éó
        function startUIUpdates() {
            function updateUI() {
                if (game && isGameInitialized) {
                    updateHUD();
                    updatePerformanceDisplay();
                    updateMinimap();
                }
                requestAnimationFrame(updateUI);
            }
            updateUI();
        }
        
        // HUDÊõ¥Êñ∞
        function updateHUD() {
            if (!game.car) return;
            
            const speed = Math.round(game.car.speed || 0);
            const rpm = Math.round(game.car.rpm || 800);
            const gear = game.car.gear || 1;
            const maxSpeed = game.car.maxSpeed || 280;
            
            // „Çπ„Éî„Éº„Éâ„É°„Éº„Çø„Éº
            document.getElementById('speed').textContent = speed;
            document.getElementById('rpm').textContent = rpm;
            
            // „ÇÆ„Ç¢Ë°®Á§∫„ÅÆÊõ¥Êñ∞
            updateGearDisplay(gear, game.car);
            
            // „Çπ„Éî„Éº„Éâ„Ç≤„Éº„Ç∏ÔºàÈáùÔºâ
            const speedNeedle = document.getElementById('speedNeedle');
            const speedPercentage = Math.min(speed / maxSpeed, 1);
            const needleRotation = speedPercentage * 180 - 90; // -90Â∫¶„Åã„Çâ90Â∫¶
            speedNeedle.style.transform = `translate(-50%, -100%) rotate(${needleRotation}deg)`;
            
            // „Çπ„Éî„Éº„Éâ„Éê„Éº
            document.getElementById('speedBar').style.width = `${speedPercentage * 100}%`;
            document.getElementById('speedPercentage').textContent = `${Math.round(speedPercentage * 100)}%`;
            
            // „É©„ÉÉ„ÉóÊÉÖÂ†±
            if (game.gameState) {
                document.getElementById('currentLap').textContent = game.gameState.currentLap || 1;
                document.getElementById('totalLaps').textContent = game.gameState.totalLaps || 3;
                
                // „Çø„Ç§„É†Ë°®Á§∫
                document.getElementById('currentTime').textContent = formatTime(game.gameState.totalTime || 0);
                document.getElementById('lapTime').textContent = formatTime(game.gameState.lapTime || 0);
                
                const bestTime = window.dataManager.getBestTime(game.car.vehicleType);
                document.getElementById('bestTime').textContent = bestTime ? formatTime(bestTime) : '--:--';
                
                if (game.gameState.lastLapTime) {
                    document.getElementById('lastLap').textContent = formatTime(game.gameState.lastLapTime);
                }
                
                // „É©„ÉÉ„Éó„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº
                updateLapIndicator(game.gameState.currentLap, game.gameState.totalLaps);
            }
        }
        
        // „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπË°®Á§∫Êõ¥Êñ∞
        function updatePerformanceDisplay() {
            if (game.performanceMonitor) {
                document.getElementById('fpsDisplay').textContent = Math.round(game.performanceMonitor.fps || 0);
                document.getElementById('trianglesDisplay').textContent = game.renderer.info.render.triangles || 0;
                document.getElementById('drawCallsDisplay').textContent = game.renderer.info.render.calls || 0;
            }
            
            if (game.cameraController) {
                const modes = ['Follow', 'Chase', 'Cockpit', 'Overhead'];
                document.getElementById('cameraModeDisplay').textContent = modes[game.cameraController.currentMode] || 'Unknown';
            }
        }
        
        // „Éü„Éã„Éû„ÉÉ„ÉóÊõ¥Êñ∞
        function updateMinimap() {
            if (!game.car || !game.car.mesh) return;
            
            const car = game.car.mesh;
            const minimapCar = document.getElementById('minimapCar');
            
            // „Éà„É©„ÉÉ„ÇØ‰∏≠ÂøÉ„Åã„Çâ„ÅÆÁõ∏ÂØæ‰ΩçÁΩÆ„ÇíË®àÁÆó
            const trackRadius = 120;
            const minimapRadius = 80;
            
            const x = (car.position.x / trackRadius) * minimapRadius;
            const z = (car.position.z / trackRadius) * minimapRadius;
            
            minimapCar.style.left = `${100 + x}px`;
            minimapCar.style.top = `${100 + z}px`;
        }
        
        // „É©„ÉÉ„Éó„Ç§„É≥„Ç∏„Ç±„Éº„Çø„ÉºÊõ¥Êñ∞
        function updateLapIndicator(currentLap, totalLaps) {
            const indicator = document.getElementById('lapIndicator');
            indicator.innerHTML = '';
            
            for (let i = 1; i <= totalLaps; i++) {
                const dot = document.createElement('div');
                dot.className = 'lap-dot';
                
                if (i < currentLap) {
                    dot.classList.add('completed');
                } else if (i === currentLap) {
                    dot.classList.add('current');
                }
                
                indicator.appendChild(dot);
            }
        }
        
        // ÊôÇÈñì„Éï„Ç©„Éº„Éû„ÉÉ„Éà
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}:${remainingSeconds.toFixed(2).padStart(5, '0')}`;
        }
        
        // „ÇÆ„Ç¢Ë°®Á§∫Êõ¥Êñ∞
        function updateGearDisplay(gear, car) {
            // „ÇÆ„Ç¢Ë°®Á§∫
            let gearText = gear;
            if (gear === -1) gearText = 'R';
            else if (gear === 0) gearText = 'N';
            
            document.getElementById('gearDisplay').textContent = gearText;
            
            // „Éà„É©„É≥„Çπ„Éü„ÉÉ„Ç∑„Éß„É≥„É¢„Éº„ÉâË°®Á§∫
            const modeElement = document.getElementById('transmissionMode');
            if (car.isAutomatic) {
                modeElement.textContent = '[AT]';
                modeElement.style.color = '#4CAF50';
            } else {
                modeElement.textContent = '[MT]';
                modeElement.style.color = '#FF9800';
            }
            
            // „ÇØ„É©„ÉÉ„ÉÅË°®Á§∫Ôºà„Éû„Éã„É•„Ç¢„É´ÊôÇ„ÅÆ„ÅøÔºâ
            const clutchElement = document.getElementById('clutchDisplay');
            if (car.isAutomatic) {
                clutchElement.style.display = 'none';
            } else {
                clutchElement.style.display = 'inline';
                const clutchPercentage = Math.round(car.clutch * 100);
                clutchElement.textContent = `„ÇØ„É©„ÉÉ„ÉÅ: ${clutchPercentage}%`;
                clutchElement.style.color = clutchPercentage < 50 ? '#ff4444' : '#4CAF50';
            }
            
            // „ÇÆ„Ç¢„ÉÅ„Çß„É≥„Ç∏‰∏≠Ë°®Á§∫
            const shiftingElement = document.getElementById('shiftingIndicator');
            if (car.isShifting) {
                shiftingElement.textContent = '‚ö° „ÇÆ„Ç¢„ÉÅ„Çß„É≥„Ç∏‰∏≠';
                shiftingElement.style.color = '#FFD700';
            } else {
                shiftingElement.textContent = '';
            }
        }
        
        // „Ç≠„Éº„Éú„Éº„Éâ„Ç§„Éô„É≥„Éà
        document.addEventListener('keydown', (event) => {
            if (!isGameInitialized) return;
            
            // ESC„Ç≠„Éº„Åß„É°„Éã„É•„ÉºÂàáÊõø
            if (event.code === 'Escape') {
                if (gameStateManager.currentState === 'playing') {
                    gameStateManager.setState('paused');
                } else if (gameStateManager.currentState === 'paused') {
                    gameStateManager.setState('playing');
                }
                event.preventDefault();
            }
            
            // Èü≥Â£∞ÂÜçÁîüÔºà„É¶„Éº„Ç∂„Éº„Ç§„É≥„Çø„É©„ÇØ„Ç∑„Éß„É≥ÂæåÔºâ
            window.audioManager.resumeContext();
        });
        
        // „Ç¶„Ç£„É≥„Éâ„Ç¶„É™„Çµ„Ç§„Ç∫ÂØæÂøú
        window.addEventListener('resize', () => {
            if (game && game.renderer) {
                game.renderer.setSize(window.innerWidth, window.innerHeight);
                if (game.camera) {
                    game.camera.aspect = window.innerWidth / window.innerHeight;
                    game.camera.updateProjectionMatrix();
                }
            }
        });
        
        // „Éö„Éº„Ç∏Èõ¢ËÑ±ÊôÇ„ÅÆÁ¢∫Ë™ç
        window.addEventListener('beforeunload', (event) => {
            if (isGameInitialized && gameStateManager.currentState === 'playing') {
                event.preventDefault();
                event.returnValue = '„É¨„Éº„Çπ‰∏≠„Åß„Åô„ÄÇÊú¨ÂΩì„Å´„Éö„Éº„Ç∏„ÇíÈõ¢„Çå„Åæ„Åô„ÅãÔºü';
            }
        });
        
        // „Éö„Éº„Ç∏„ÅÆÂèØË¶ñÊÄßÂ§âÊõ¥ÊôÇ„ÅÆÂá¶ÁêÜ
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && gameStateManager && gameStateManager.currentState === 'playing') {
                gameStateManager.setState('paused');
            }
        });
        
        // ÂàùÊúüÂåñÈñãÂßã
        window.addEventListener('load', () => {
            // THREE.js„ÅÆË™≠„ÅøËæº„ÅøÂÆå‰∫Ü„ÇíÁ¢∫ÂÆü„Å´„Åô„Çã„Åü„ÇÅÈÅÖÂª∂
            setTimeout(() => {
                if (typeof THREE === 'undefined') {
                    console.error('THREE.js not loaded');
                    return;
                }
                initializeGame();
            }, 1000);
        });
        
        // „Ç∞„É≠„Éº„Éê„É´„Ç¢„ÇØ„Çª„ÇπÁî®
        window.game = game;
        window.gameStateManager = gameStateManager;
    </script>
</body>
</html>